<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">
<head>
  <meta charset="UTF-8"/>
  <title>CoVizu</title>
  <meta name="description"
        content="CoVizu: analyse et visualisation en temps réel de la diversité globale des génomes du SRAS-CoV-2.">
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="css/style.css">

  <script src="js/jquery.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script src="js/d3.js"></script>
  <script src="js/d3-scale.js"></script>
  <script src="js/FileSaver.js"></script>
  <script src="js/d3-save-svg.min.js"></script>
</head>

<body>
  <script>
    /*
     Language translations in other files.

     Change this for every index-lang.html
     Note: cannot display HTML in title attribute, i.e., &eacute; will not render.
     i18n = internationalization
     */
    var i18n_text = {
      // time-tree legend titles
      region_legend: {
        "Africa": "Afrique",  // English -> lang
        "Asia": "Asie",
        "China": "Chine",
        "Europe": "Europe",
        "North America": "Amérique du Nord",
        "Oceania": "Océanie",
        "South America": "Amérique du Sud"
      },
      sample_legend: "Taille de l'échantillon (log10)",
      coldate_legend: "Date des échantillons les plus récents",
      diverge_legend: "Divergence (prédiction d'horloge moléculaire stricte)",
      total: "Total",

      // side bar data statistics
      last_update: "Dernière révision",
      number_genomes: "Nombre de génomes",

      // tooltips
      tip_diffs: "Nombre moyen de mutations",
      tip_residual: "Écart à la régression temporelle",
      tip_cases: "Nombre de cas",
      tip_varcount: "Nombre de variants",
      tip_coldates: "Dates de collecte",
    };

  </script>

  <div class="tooltip" id="tooltipContainer"></div>

  <div class="app">
    <div class="app-left">
      <div class="bar" style="top: 10px; left: 10px; z-index:10" >
        <!-- <span style="display: inline-block; width: 250px; vertical-align: top"> -->
        <div class="legend-container">
          <label for="select-tree-colours">Colorer les branches:</label>
          <select name="tree-colours" id="select-tree-colours">
            <option value="Region">Région</option>
            <option value="No. samples">T. de l'échantillon</option>
            <option value="Collection date">Date de collecte</option>
            <option value="Divergence">Divergence</option>
          </select>
          <div class="legend" id="div-region-legend"></div>
          <div class="legend" id="svg-sample-legend"></div>
          <div class="legend" id="svg-coldate-legend"></div>
          <div class="legend" id="svg-diverge-legend"></div>
        </div>
        <!-- </span> -->

        <!-- <span style="display: inline-block; vertical-align: top"> -->
        <div class="search-bar-container">
          <div id="search-bar">
            <input type="search" id="search-input"
                    placeholder="e.g., B.1.351 ou EPI_ISL_434070 ou Canada">
            <input id="start-date" class="dates"
                      placeholder="Début">
            to
            <input id="end-date" class="dates"
                      placeholder="Fin">
            <span onclick="$('#help-search').dialog('open');" style="cursor: help">&#128304;</span>
          </div>
          <br/>
          
          <div id="navigation" style="padding-top: 5px">
            <button type="button" id="search-button">Rechercher</button>
            <button type="button" id="clear_button">Réinitialiser</button>
            <button type="button" id="previous_button">Précédent</button>
            <button type="button" id="next_button">Suivant</button>
            <span id="search_stats">0 de 0 points</span>
          </div>
          <div style="padding-top: 5px;">
            <img id="loading" src="img/Loading_icon_cropped.gif"/>
            <span id="loading_text"></span>
            <span id="error_message"></span>
          </div>
        </div>
        <!-- </span> -->
      </div>
    
      <div class="tree-beadplot">
        <div class="leftbox">
          <div class="floattitle">
            Phylogénie temporelle
            <span class="clicker" title="Télécharger la phylogénie" onclick="save_timetree()">
              &nbsp;&nbsp;NWK&nbsp;&nbsp;
            </span>
            <span title="Aider avec la phylogénie" onclick="$('#help-timetree').dialog('open');" style="cursor: help">&#128304;</span>
          </div>
          <div class="floattitle" id="svg-timetreeaxis" style="top: 58px; z-index: 13"></div>
          <div class="tree-container">
            <div class="tree-content" id="svg-timetree" style="width: 250px; max-width: 250px;"></div>
          </div>
        </div>

        <div class="middlebox">
          <div class="floattitle">
            Diagramme perle
            <span class="clicker" title="Télécharger comme un arbre" onclick="save_beadplot();">
              &nbsp;&nbsp;NWK&nbsp;&nbsp;
            </span>
            <!--<button type="button" id="save_svg">Export SVG</button>-->
            <span class="clicker" title="Télécharger le SVG" onclick="export_svg();">
              &nbsp;&nbsp;SVG&nbsp;&nbsp;
            </span>
            <span title="Aide avec le diagramme perle" onclick="$('#help-beadplot').dialog('open');" style="cursor: help">&#128304;</span>

            <span style="width: 150px;">
              <label style="vertical-align: middle;" for="vedge-slider">Limite de liens:&nbsp;&nbsp;</label>
              <div id="vedge-slider">
                <div id="custom-handle" class="ui-slider-handle"></div>
              </div>
            </span>
          </div>
          <div class="floattitle" id="svg-clusteraxis" style="top: 58px; z-index: 14"></div>
          <div class="beadplot-content" id="svg-cluster"></div>
        </div>
      </div>
    </div>

    <div class="app-right">
      <div class="sticky">
        <div style="top: 0; right: 0; z-index: 10; width: 270px">
          <a href="https://github.com/PoonLab/covizu" target=“_new” class="github-corner" aria-label="View source on GitHub">
            <!-- https://github.com/tholman/github-corners -->
            <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0; z-index: 21" aria-hidden="true">
              <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
              <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
              <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
            </svg>
          </a>
        </div>
        <div class="rightbox">
          <div style="padding-top: 10px;"><h1>CoVizu</h1></div>
          <div style="padding-top: 10px; padding-right: 6px;">
            <h3>Visualisation en temps réel de la variation génomique du SRAS-CoV-2 (hCoV-19).</h3>
          </div>
          <span style="width: 250px">
            <div class="gisaid">Basé sur les données de <a href="https://gisaid.org" target="_new">
                <img src="https://www.gisaid.org/fileadmin/gisaid/img/schild.png"
                     height="24px"/>
              </a>
            </div>
          </span>
          <p>
            <div style="font-size: 0.9em;" id="div-last-update"></div>
            <div style="padding-bottom: 20px; font-size: 0.9em;" id="div-number-genomes"></div>
          </p>

          <div id="tabs">
            <ul>
              <li><a href="#tabs-1">Pays</a></li>
              <li><a href="#tabs-2">Échantillons</a></li>
            </ul>
            <div id="tabs-1">
              <div class="breaker" id="barplot"></div>
              <div style="overflow-y: auto; overflow-x: hidden; max-height: 200px" id="country-table"></div>
            </div>
            <div id="tabs-2">
              <div id="seqtable-hint" class="hint">
                Passer la souris sur accession (EPI_ISL_#) pour afficher le laboratoire et d'autres informations.
              </div>
              <div style="overflow-y: auto; overflow-x: hidden; max-height: 200px" id="seq-table"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="splash" title="Bienvenue">
    <p>
      <b>CoVizu</b> est un <a href="https://github.com/PoonLab/CoVizu" target="_new">projet open source</a> permettant de visualiser la diversité mondiale
      des génomes du SRAS-CoV-2, fournis par
      <a href="https://gisaid.org" target="_new">l'initiative GISAID</a>.
    </p>
    <p>
      Cette page web montre deux visualisations interatives de ces données.
      Sur la gauche, est affiché un <a href="https://en.wikipedia.org/wiki/Phylogenetic_tree" target="_new">
      arbre phylogénétique</a> des relations évolutives entre les différentes
      <a href="https://cov-lineages.org" target="_new">lignées du SRAS-CoV-2</a>.
      Chacune de ces lignées regroupe plusieurs milliers des génomes similaires, reliant les
      épidémies qui se produisent &agrave; différents endroits;
      <a href="https://www.nature.com/articles/s41564-020-0770-5" target="_new">Rambaut
      <i>et al.</i> 2020</a>).
    </p>
    <p>
      En cliquant sur une lignée on fait appara&icirc;tre un &laquo;diagramme perle&raquo; au centre de la page.
      Sur une m&ecirc;me ligne horizontale sont reproupés les échantillons partageant le
      m&ecirc;me génome.
      Les cercles représentent les dates auxquelles le variant a été
      échantillonnée. Les lignes verticales représentent le (petit) nombre de mutations qui séparent les variants d'une même lignée.
    </p>
    <p>
      Pour plus d'aide, cliquez sur les
      <a style="text-decoration: none;" href="https://en.wikipedia.org/wiki/Shoshinsha_mark" target="_new">
        &#128304;</a>icones.
    </p>
  </div>

  <div id="help-timetree" title="Help: Time-scaled tree interface">
    <p>
      Un arbre phylogénétique est un modèle montrant comment differentes populations ont evolué à partir de leurs ancêtres communs.
      L'arbre representé ici (génére avec <a href="https://github.com/neherlab/treetime">
      TreeTime</a> v0.8.0) résume l'évolution des différentes <a href="https://cov-lineages.org" target="_new">lignées de SRAS-CoV-2</a>, 
      qui sont pré-définies en regroupant les virus en fonction de la similarité de leurs génomes.
    </p>
    <p>
      L'échelle temporelle est réprésentée en haut de l'arbre.
      La largeur du rectangle répresente le temps pendant lequel la lignée a ete observée,
      De la date d'émergence à la date des derniers virus observés.
      On estime la date d'emergence en comparant les génomes et en supposant 
      un <a href="http://virological.org/t/phylodynamic-analysis-176-genomes-6-mar-2020/356" target="_new">taux d'evolution constant</a>.
    </p>
    <p>
      La couleur du rectangle représentant la lignee est choisie en fonction de la région
      dans laquelle elle a été le plus souvent observée.
      Cliquez dessus pour explorer les echantillons de chaque lignée et afficher un diagramme en perle.
    </p>
  </div>

  <div id="help-beadplot" title="Help: Beadplot interface">
    <p>
      On utilise un diagramme en perle pour visualiser les différents variants de SRAS-CoV-2 d'une même <a href="https://cov-lineages.org" target="_new">lignée</a>,
      ou et quand ils ont été echantillonnés, et comment ils sont liés les uns aux autres.
      Chaque objet dans le diagramme contient des informations supplémentaires visibles en passant la souris dessus. 
    </p>
    <p>
      Chaque ligne horizontale réprésente un variant &ndash; des virus avec
      <span class="hint" title="C'est un peu plus compliqué. Beaucoup de génomes ont des séquences identiques, mais certains ont des séquences incomplètes, des parties du génome qui n'ont pas été correctement séquencées. Puisqu'on ne peut être certain à 100% que deux génomes incomplêts sont identiques, on ré-échantillonne les génomes 100 fois aléatoirement (bootstrap non-paramétrique) et on évalue la probabilité que ces genomes soient liés.">des génomes identiques</span>.
      Sur une même ligne horizontale sont dessinées des perles qui indiquent quand le variant a été échantillonné.
      Quand deux ou plus de variants descendent d'un même variant qui n'a pas été directement observé,
	  alors la ligne est grise et ne contient aucune perle ce qui indique un variant non-échantillonné. 
    </p>
    <p>
      La taille de la perle représente le nombre de fois que le variant a été observé à cette date.
      Regouper ainsi les échantillons indentiques en séquence et en date est nécessaire pour ce type d'épidemie rapide avec des centaines de milliers de séquences, <i>e.g.,</i>
      la lignée D.2 en Australie ou B.1.1.7 au Royaume-Uni.
      Les perles sont <span class="hint" title="La légende est visible sur la droite dans le diagramme en boites répresentant les régions et pays.">colorées</span>
      en fonction de la région ou les échantillons ont été le plus souvent observés.
    </p>
    <p>
      Les lignes verticales représentent les <span class="hint" title="The direction of ancestor-descendant relationships is based on midpoint rooting of the consensus neighbor-joining tree. This is a crude method, so be cautious about over-interpreting the directionality of these relationships.">relations d'ancestralité</span> entre les différentes lignes horizontales (les variants).
      Les relations sont estimées via <a href="https://en.wikipedia.org/wiki/Neighbor_joining">la methode neighbor-joining</a> en utilisant <a href="https://birc.au.dk/software/rapidnj/">RapidNJ</a>.
	  Pour chaque lien le champ "distance genomique" de l'info-bulle indique le nombre de différences (mutations) entre ancêtre et descendant.
      Puisqu'il est difficile de reconstruire la date exacte où ces mutations ont émergé,
      on a choisi d'utiliser la date où le premier échantillon a été observé.
    </p>
  </div>

  <div id="help-search" title="Help: Search interface">
    <p>
      Puisqu'il y a un nombre considérable d'échantillons séquencé qu'on tente ici de visualiser,
      on a ajouté en haut de la page une interface permettant de faire des recherches simples.
    </p>
    <p>
      Vous pouvez l'utiliser pour rechercher un échantillon particulier à partir de son accession GISAID.
      Si vous entrez le début de l'accession, le champ proposera un certain de nombre de possibilités (autocomplétion).
      Vous pouvez aussi entrer le debut d'un nom de pays, par exemple rechercher "Madaga"
      vous amènera à la première lignée qui contient des échantillons de Madagascar.
    </p>
    <p>
      Utilisez les boutons "Précédant" et "Suivant" pour naviguer entre les résultats de la recherche,
      et le bouton "Réinitialiser" pour annuler la recherche.
    </p>
  </div>

  <div id="dialog" title="Remerciements">
    <p>
      Nous addressons nos remerciements à l'initiative GISAID ainsi qu'à tous ceux qui ont produit les données,
      les auteurs, les laboratoires qui ont collecté les échantillons des patients, et les laboratoires qui ont 
      réalisé le séquençage, l'assemblage des génomes, les métadonnées, et qui ont partagé leurs données sur GiSAID,
      nous permettant de réaliser cette visualisation.
    </p>
    <p>
      Elbe, S., and Buckland-Merrett, G. (2017)
      Data, disease and diplomacy: GISAID’s innovative contribution to global health.
      <i>Global Challenges</i>, 1:33-46.<br/>
      DOI: <a href="https://doi.org/10.1002/gch2.1018" target=“_new”>10.1002/gch2.1018</a>&nbsp;&nbsp;
      PMCID: <a href="https://pubmed.ncbi.nlm.nih.gov/31565258/" target=“_new”>31565258</a>
    </p>
    <p>
      Note : si vous utilisez les résultats de ces analyses dans vos publications, assurez-vous de mentionner et remercier
      les auteurs des données : “We gratefully acknowledge all the Authors,
      the Originating laboratories responsible for obtaining the specimens, and the Submitting
      laboratories for generating the genetic sequence and metadata and sharing via the GISAID
      Initiative, on which this research is based.”
    </p>
    <p>
      Also, cite the following reference:
      Shu, Y., McCauley, J. (2017) GISAID: From vision to reality. <i>EuroSurveillance</i>, 22(13)<br/>
      DOI: <a href="https://www.eurosurveillance.org/content/10.2807/1560-7917.ES.2017.22.13.30494" target=“_new”>10.2807/1560-7917.ES.2017.22.13.30494</a>&nbsp;&nbsp;
      PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5388101/" target=“_new”>PMC5388101</a>
    </p>
  </div>


  <footer class="footer">
    GISAID data provided on this website are subject to GISAID’s
    <a href="https://www.gisaid.org/DAA/" target=“_new”>Terms and Conditions</a>
    &emsp;&emsp;
    <button class="ack" id="ack-open" onclick="console.log('click');">Acknowledgements</button>

  </footer>

  <script src="js/beadplot.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/drawtree.js"></script>
  <script src="js/phylo.js"></script>
  <script src="js/search.js"></script>
  <script src="js/gisaid/gisaid.js?random=1"></script>

  <script src="js/covizu.js"></script>
</body>
</html>
