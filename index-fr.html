<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta charset="UTF-8"/>
  <title>CoVizu</title>
  <meta name="description"
        content="CoVizu: L'analyser et visualisation la diversit&eacute; globale des g&eacute;nomes du SRAS-CoV-2 en temps r&eacute;el.">
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="css/style.css">

  <script src="js/jquery.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script src="js/d3.js"></script>
  <script src="js/d3-scale.js"></script>
  <script src="js/FileSaver.js"></script>
  <script src="js/d3-save-svg.min.js"></script>
</head>

<body>
  <script>
    /*
     Language translations for text in other files.
     Change this for every index-lang.html
     Note: we cannot display HTML in title attribute, i.e., &eacute; will not render.
     */
    var i18n_text = {
      // time-tree legend titles
      region_legend: {
        "Africa": "Afrique",  // English -> lang
        "Asia": "Asie",
        "China": "Chine",
        "Europe": "L'Europe",
        "North America": "Amérique du Nord",
        "Oceania": "Océanie",
        "South America": "Amérique du Sud"
      },
      sample_legend: "Taille de l'échantillon (log10)",
      coldate_legend: "Date de l'echantillon précédente",
      diverge_legend: "Divergence (prédiction d'horloge stricte)",
      total: "Total",

      // side bar data statistics
      last_update: "Révision précédente",
      number_genomes: "Nombre de génomes",
      number_cases: "Nombre de cas",
      region: "Région",
      countries: "Pays",
      samples: "Échantillons",

      // tooltips
      tip_diffs: "Moyen de différences à la racine",
      tip_residual: "Déviation de l'horloge",
      tip_cases: "Nombre de cas",
      tip_varcount: "Nombre de variantes",
      tip_coldates: "Dates de collecte",

      vedge_parent: "Parent",
      vedge_child: "Enfant",
      vedge_distance: "Distance génomique",
      vedge_support: "Support",
      vedge_coldate: "Date de collecte",

      hedge_unique_dates: "Dates de collecte uniques",
      hedge_coldates: "Dates de collecte",

      sample_orig_lab: "Laboratoire d'origine",
      sample_subm_lab: "Laboratoire de soumission",
      sample_authors: "Auteurs",

      // miscellaneous
      okay: "D'accord!",
      got_it: "J'ai compris!",
      loading: `Chargement en cours.  Un moment, s'il vous plait...`,
      loading_json: "Chargement les donn&eacute;es JSON depuis le serveur (~10 sec)...",
      zero_points: `0 de 0 points`,
      country_theaders: ["Région", "Pays", "Compte"],
      sample_theaders: ["Num d'ordre", "Nom", "Date"],
    };

  </script>

  <div class="tooltip" id="tooltipContainer"></div>

  <div class="app">
    <div class="app-left">
      <div class="bar" style="top: 10px; left: 10px; z-index:10" >
        <!-- <span style="display: inline-block; width: 250px; vertical-align: top"> -->
        <div class="legend-container">
          <label for="select-tree-colours">Colorer les branches:</label>
          <select name="tree-colours" id="select-tree-colours">
            <option value="Region">R&eacute;gion</option>
            <option value="No. samples">T. de l'&eacute;chantillon</option>
            <option value="Collection date">Date de collecte</option>
            <option value="Divergence">Divergence</option>
          </select>
          <div class="legend" id="div-region-legend"></div>
          <div class="legend" id="svg-sample-legend"></div>
          <div class="legend" id="svg-coldate-legend"></div>
          <div class="legend" id="svg-diverge-legend"></div>
        </div>
        <!-- </span> -->

        <!-- <span style="display: inline-block; vertical-align: top"> -->
        <div class="search-bar-container">
          <div id="search-bar">
            <input type="search" id="search-input"
                    placeholder="e.g., B.1.351 ou EPI_ISL_434070 ou Canada">
            <input id="start-date" class="dates"
                      placeholder="D&eacute;but">
            to
            <input id="end-date" class="dates"
                      placeholder="Fin">
            <span onclick="$('#help-search').dialog('open');" style="cursor: help">&#128304;</span>
          </div>
          <br/>
          
          <div id="navigation" style="padding-top: 5px">
            <button type="button" id="search-button">Rechercher</button>
            <button type="button" id="clear_button">R&eacute;initialiser</button>
            <button type="button" id="previous_button">Pr&eacute;c&eacute;dent</button>
            <button type="button" id="next_button">Suivant</button>
            <span id="search_stats">0 de 0 points</span>
          </div>
          <div style="padding-top: 5px;">
            <img id="loading" src="img/Loading_icon_cropped.gif"/>
            <span id="loading_text"></span>
            <span id="error_message"></span>
          </div>
        </div>
        <!-- </span> -->
      </div>
    
      <div class="tree-beadplot">
        <div class="leftbox">
          <div class="floattitle">
            Phylog&eacute;nie &eacute;chelonn&eacute; sur le temps
            <span class="clicker" title="T&eacute;l&eacute;charger la phylog&eacute;nie" onclick="save_timetree()">
              &nbsp;&nbsp;NWK&nbsp;&nbsp;
            </span>
            <span title="Aider avec la phylog&eacute;nie" onclick="$('#help-timetree').dialog('open');" style="cursor: help">&#128304;</span>
          </div>
          <div class="floattitle" id="svg-timetreeaxis" style="top: 58px; z-index: 13"></div>
          <div class="tree-container">
            <div class="tree-content" id="svg-timetree" style="width: 250px; max-width: 250px;"></div>
          </div>
        </div>

        <div class="middlebox">
          <div class="floattitle">
            Diagramme perle
            <span class="clicker" title="T&eacute;l&eacute;charger comme un arbre" onclick="save_beadplot();">
              &nbsp;&nbsp;NWK&nbsp;&nbsp;
            </span>
            <!--<button type="button" id="save_svg">Export SVG</button>-->
            <span class="clicker" title="T&eacute;l&eacute;charger le SVG" onclick="export_svg();">
              &nbsp;&nbsp;SVG&nbsp;&nbsp;
            </span>
            <span title="Aider avec le diagramme perle" onclick="$('#help-beadplot').dialog('open');" style="cursor: help">&#128304;</span>

            <span style="width: 150px;">
              <label style="vertical-align: middle;" for="vedge-slider">Limite de liens:&nbsp;&nbsp;</label>
              <div id="vedge-slider">
                <div id="custom-handle" class="ui-slider-handle"></div>
              </div>
            </span>
          </div>
          <div class="floattitle" id="svg-clusteraxis" style="top: 58px; z-index: 14"></div>
          <div class="beadplot-content" id="svg-cluster"></div>
        </div>
      </div>
    </div>

    <div class="app-right">
      <div class="sticky">
        <div style="top: 0; right: 0; z-index: 10; width: 270px">
          <a href="https://github.com/PoonLab/covizu" target=“_new” class="github-corner" aria-label="View source on GitHub">
            <!-- https://github.com/tholman/github-corners -->
            <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0; z-index: 21" aria-hidden="true">
              <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
              <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
              <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
            </svg>
          </a>
        </div>
        <div class="rightbox">
          <div style="padding-top: 10px; cursor: help;">
            <h1><span onclick="$('#splash').dialog('open');">CoVizu</span></h1>
          </div>
          <div style="padding-top: 10px; padding-right: 6px;">
            <h3>Visualisation de la variation g&eacute;nomique du SRAS-CoV-2 (hCoV-19) en temps r&eacute;el.</h3>
          </div>
          <span style="width: 250px">
            <div class="gisaid">Activ&eacute; par les donn&eacute;es de&nbsp;<a href="https://gisaid.org" target="_new">
                <img src="https://www.gisaid.org/fileadmin/gisaid/img/schild.png"
                     height="24px"/>
              </a>
            </div>
          </span>
          <p>
            <div style="font-size: 0.9em;" id="div-last-update"></div>
            <div style="padding-bottom: 20px; font-size: 0.9em;" id="div-number-genomes"></div>
          </p>

          <div id="tabs">
            <ul>
              <li><a href="#tabs-1">Pays</a></li>
              <li><a href="#tabs-2">&Eacute;chantillons</a></li>
            </ul>
            <div id="tabs-1">
              <div class="breaker" id="barplot"></div>
              <div style="overflow-y: auto; overflow-x: hidden; max-height: 200px" id="country-table"></div>
            </div>
            <div id="tabs-2">
              <div id="seqtable-hint" class="hint">
                Survoler le num&eacute;ro d'ordre (EPI_ISL_#) pour afficher les informations du laboratoires et l'auteurs.
              </div>
              <div style="overflow-y: auto; overflow-x: hidden; max-height: 200px" id="seq-table"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="splash" title="Bienvenue">
    <p>
      <b>CoVizu</b> est un <a href="https://github.com/PoonLab/CoVizu" target="_new">projet de
      code source ouvert</a> s'effor&ccedil;ant de visualisation de la diversit&eacute; mondiale
      du g&eacute;nomes du SRA-CoV-2, qui sont fournis par
      <a href="https://gisaid.org" target="_new">l'initiative GISAID</a>.
    </p>
    <p>
      Cette page web offre deux visualisations interatifs de ces donn&eacute;es.
      Sur la gauche, il affiche un <a href="https://en.wikipedia.org/wiki/Phylogenetic_tree" target="_new">
      arbre phylog&eacute;n&eacute;tique</a> résumant les relations évolutives entre les différentes
      <a href="https://cov-lineages.org" target="_new">lign&eacute;es du SRAS-CoV-2</a>
      (groupements de virus avec des g&eacute;nomes similaires, utile pour relier les
      &eacute;pid&eacute;mies &agrave; diff&eacute;rents endroits;
      <a href="https://www.nature.com/articles/s41564-020-0770-5" target="_new">Rambaut
      <i>et al.</i> 2020</a>).
      On peut naviguer entre langues diff&eacute;rentes par cliquant sur leurs bo&icirc;tes respectives.
    </p>
    <p>
      La s&eacute;lection d'une lign&eacute;e fait un &laquo;diagramme perle&raquo; au milieu de la page.
      Chaque ligne horizontale repr&eacute;sente un ou plusieurs &eacute;chantillons partageant le
      m&ecirc;me s&eacute;quence g&eacute;nome.
      Les perles sur la ligne repr&eacute;sentent les dates auxquelles la variante a &eacute;t&eacute;
      &eacute;chantillonn&eacute;e.
    </p>
    <p>
      Pour plus d'aide, cliquez sur l'ic&ocirc;ne
      <a style="text-decoration: none;" href="https://en.wikipedia.org/wiki/Shoshinsha_mark" target="_new">
        &#128304;</a>.
    </p>
  </div>

  <div id="help-timetree" title="Aider: Interface de l'arbre">
    <p>
      Un arbre phylog&eacute;n&eacute;tique est un mod&egrave;le des relations ancestrales de
      populations diff&eacute;rentes.
      L'arbre ici (g&eacute;n&eacute;r&eacute; par <a href="https://github.com/neherlab/treetime">
      TreeTime</a> v0.8.0) r&eacute;sume l'ascendance commune des
      <a href="https://cov-lineages.org" target="_new">lignes SRAS-CoV-2</a>,
      qui sont des groupes de virus pr&eacute;d&eacute;finis bas&eacute; sur leur similitude
      g&eacute;n&eacute;tique.
    </p>
    <p>
      Un &eacute;chelle de temps est dessin&eacute; ci-dessus l'arbre et marqu&eacute; avec des
      <a href="https://en.wikipedia.org/wiki/ISO_8601" target="_new">dates</a>.
      Le plus ancien anc&ecirc;tre (le racine) est dessin&eacute; &agrave; gauche, et les descendants
      les plus r&eacute;cemment observ&eacute;s sont sur la droite.
      Nous estimons les dates des anc&ecirc;tres communs en comparant les g&eacute;nomes
      &eacute;chantillonn&eacute;s et en supposant que le taux d'&eacute;volution a &eacute;t&eacute;
      <a href="http://virological.org/t/phylodynamic-analysis-176-genomes-6-mar-2020/356" target="_new">constant</a>.
    </p>
    <p>
      Pour chaque ling&eacute;es, nous dessinons un rectangle pour repr&eacute;senter
      la plague de dates de pr&eacute;l&egrave;vement des &eacute;chantillons, et le
      colorons en fonctoin de la r&eacute;gion g&eacute;ographique la plus courante.
      Pour explorer les &eacute;chantillons au sein d'une lign&eacute;e, cliquez sur
      l'&eacute;tiquette (par exemple, &laquo;B.4&raquo;) ou le rectangle pour
      r&eacute;cup&eacute;rer le diagramme perle associ&eacute;.
    </p>
  </div>

  <div id="help-beadplot" title="Aider: Interface du diagramme perle">
    <p>
      Nous utilisons les diagrammes perle pour visualiser les variantes de SRAS-CoV-2
      au sein d'une <a href="https://cov-lineages.org" target="_new">lign&eacute;e</a>,
      o&ugrave; et quand ils ont &eacute;t&eacute; &eacute;chantillonn&eacute;s, et
      comment ils sont li&eacute;s les uns aux autres.
      Chaque objet du diagramme perle a des informations suppl&eacute;mentaires dans une
      info-bulle (que vous visualisez en survolant cet objet avec le pointeur de votre souris).
    </p>
    <p>
      Chaque segment de ligne horizontale repr&eacute;sente une variante &ndash; virus avec des g&eacute;nomes
      <span class="hint" title="C'est un peu plus compliqu&eacute;.  De nombreux g&eacute;nomes sont identiques en s&eacute;quence, mais bien d'autres a ont des informations manquantes - parties du g&eacute;nome qui n'ont pas &eacute;t&eacute; s&eacute;quenc&eacute;es.  Puisque nous ne pouvons pas &ecirc;tre s&ucirc;r &agrave; 100% que deux g&eacute;nomes avec des parties manquantes sont identiques, nous r&eacute;&eacute;chantillonnons les g&eacute;nomes 100 fois (bootstrap non-param&eacute;trique) et &eacute;valuer la fr&eacute;quence &agrave; laquelle ils sont s&eacute;par&eacute;s dans notre analyse.">identiques</span>.
      Nous dessinons les perles sur une ligne pour indiquer quand cette variante a &eacute;t&eacute;
      &eacute;chatillonn&eacute;e.
      S'il n'y a pas de perles sur la ligne et qu'elle est grise, alors c'est une variante non
      &eacute;chatillonn&eacute;e: deux ou plusieurs variantes &eacute;chatillonn&eacute;e
      descendent d'une variante ancestrale qui n'a pas &eacute;t&eacute; directement observ&eacute;e.
    </p>
    <p>
      L'aire de la perle est mis &agrave; l'&eacute;chelle proportionnellement &agrave; le nombre
      de fois que cette variante a &eacute;t&eacute; &eacute;chatillonn&eacute;e ce jour-l&agrave;.
      Ceci est important pour les &eacute;pid&eacute;mies rapides ou avec &eacute;chantillonnage intensif;
      par exemple, le lign&eacute;e D.2 &agrave; Australie.
      Les perles sont color&eacute;es selon la r&eacute;gion g&eacute;ographique la plus commune des
      &eacute;chantillons, ou d'autres informations comme vous voulez.
    </p>
    <p>
      Nous dessinons des lignes verticales qui relient les variantes &agrave; leurs
      <span class="hint" title="Le direction des relations anc&ecirc;tres-descendants est, en effet, déterminé par les degrés des n&oelig;uds en l'arbre non racin&eacute;.  Celui est une m&eacute;thode brute, alors soyez prudent lorsque interpr&eacute;r le sens de ces relations.">anc&ecirc;tres communs</span>.


      These relationships are estimated by the <a href="https://en.wikipedia.org/wiki/Neighbor_joining">neighbor-joining method</a> using
      <a href="https://birc.au.dk/software/rapidnj/">RapidNJ</a>.
      Tooltips for each edge report the number of genetic differences (mutations)
      between ancestor and descendant as the "genomic distance".
      Since it's difficult to reconstruct exactly when these mutations occurred,
      we simply map each line to when the first sample was collected.
    </p>
  </div>

  <div id="help-search" title="Help: Search interface">
    <p>
      Since there is an overwhelming number of sampled infections that we are trying to visualize
      here, we have built a basic search interface that you can interact with using the inputs
      at the top of this web page.
    </p>
    <p>
      You can use the text box to find a specific sample by GISAID accession number.
      If you start to enter an accession number, the text box will display a number of
      possibilities (autocompletion).
      You can also search samples by substring (case-sensitive).
      For example, searching for "Madaga" (hit enter to submit) will jump to the first lineage that
      contains a sample from Madagascar.
    </p>
    <p>
      Use the "Previous" and "Next" buttons to iterate through your search results, and the "Clear"
      button to reset the search interface.
    </p>
  </div>

  <div id="dialog" title="Acknowledgements">
    <p>
      We would like to thank the GISAID Initiative and are grateful to all of the data contributors,
      i.e. the Authors, the Originating laboratories responsible for obtaining the specimens, and
      the Submitting laboratories for generating the genetic sequence and metadata and sharing via
      the GISAID Initiative, on which this research is based.
    </p>
    <p>
      Elbe, S., and Buckland-Merrett, G. (2017)
      Data, disease and diplomacy: GISAID’s innovative contribution to global health.
      <i>Global Challenges</i>, 1:33-46.<br/>
      DOI: <a href="https://doi.org/10.1002/gch2.1018" target=“_new”>10.1002/gch2.1018</a>&nbsp;&nbsp;
      PMCID: <a href="https://pubmed.ncbi.nlm.nih.gov/31565258/" target=“_new”>31565258</a>
    </p>
    <p>
      Note: When using results from these analyses in your manuscript, ensure that you also
      acknowledge the Contributors of data, i.e. “We gratefully acknowledge all the Authors,
      the Originating laboratories responsible for obtaining the specimens, and the Submitting
      laboratories for generating the genetic sequence and metadata and sharing via the GISAID
      Initiative, on which this research is based.”
    </p>
    <p>
      Also, cite the following reference:
      Shu, Y., McCauley, J. (2017) GISAID: From vision to reality. <i>EuroSurveillance</i>, 22(13)<br/>
      DOI: <a href="https://www.eurosurveillance.org/content/10.2807/1560-7917.ES.2017.22.13.30494" target=“_new”>10.2807/1560-7917.ES.2017.22.13.30494</a>&nbsp;&nbsp;
      PMCID: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5388101/" target=“_new”>PMC5388101</a>
    </p>
  </div>


  <footer class="footer">
    GISAID data provided on this website are subject to GISAID’s
    <a href="https://www.gisaid.org/DAA/" target=“_new”>Terms and Conditions</a>
    &emsp;&emsp;
    <button class="ack" id="ack-open" onclick="console.log('click');">Acknowledgements</button>

  </footer>

  <script src="js/beadplot.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/drawtree.js"></script>
  <script src="js/phylo.js"></script>
  <script src="js/search.js"></script>
  <script src="js/gisaid/gisaid.js?random=1"></script>

  <script src="js/covizu.js"></script>
</body>
</html>
